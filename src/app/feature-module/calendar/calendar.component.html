<div class="page-wrapper">
  <div class="content">
    <!-- Breadcrumb -->
    <div
      class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3"
    >
      <div class="my-auto mb-2">
        <h2 class="mb-1">Calendrier des congés</h2>
        <nav>
          <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item">
              <a [routerLink]="routes.index"
                ><i class="ti ti-smart-home"></i
              ></a>
            </li>
            <li class="breadcrumb-item">Application</li>
            <li class="breadcrumb-item active" aria-current="page">Congés</li>
          </ol>
        </nav>
      </div>
      <div class="d-flex my-xl-auto right-content align-items-center flex-wrap">
        <div class="me-2 mb-2">
          <app-date-range-picker />
        </div>
        <div class="me-2 mb-2">
          <div class="dropdown">
            <a
              href="javascript:void(0);"
              class="dropdown-toggle btn btn-white d-inline-flex align-items-center"
              data-bs-toggle="dropdown"
            >
              <i class="ti ti-file-export me-1"></i>Export
            </a>
            <ul class="dropdown-menu dropdown-menu-end p-3">
              <li>
                <a href="javascript:void(0);" class="dropdown-item rounded-1"
                  ><i class="ti ti-file-type-pdf me-1"></i>Export as PDF</a
                >
              </li>
              <li>
                <a href="javascript:void(0);" class="dropdown-item rounded-1"
                  ><i class="ti ti-file-type-xls me-1"></i>Export as Excel
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="mb-2">
          <a
            href="#"
            data-bs-toggle="modal"
            data-bs-target="#add_event"
            class="btn btn-primary d-flex align-items-center"
            ><i class="ti ti-circle-plus me-2"></i>Create</a
          >
        </div>
        <app-collapse-header />
      </div>
    </div>

    <div class="row">
      <!-- Calendar Sidebar -->
      <div class="col-xxl-3 col-xl-4">
        <div class="card">
          <div class="card-body p-3 p-inlines">
            <div class="border-bottom pb-2 mb-4">
              <!-- <p-calendar
                class="max-w-full"
                [(ngModel)]="date"
                [inline]="true"
                [showWeek]="false"
              /> -->
            </div>

            <!-- Event -->
            <div class="border-bottom pb-4 mb-4">
              <div
                class="d-flex align-items-center justify-content-between mb-2"
              >
                <h5>Les types de congés</h5>
                <a
                  href="#"
                  class="link-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#add_event"
                  ><i class="ti ti-square-rounded-plus-filled fs-16"></i
                ></a>
              </div>

              <div id="external-events">
                <div
                  class="fc-event bg-transparent-warning mb-1"
                  data-event='{ "title": "Congé Exceptionnel" }'
                  data-event-classname="bg-transparent-warning"
                >
                  <i class="ti ti-square-rounded text-warning me-2"></i>Congé
                  Exceptionnel
                </div>
                <div
                  class="fc-event bg-transparent-info mb-0"
                  data-event='{ "title": "Congé annuel" }'
                  data-event-classname="bg-transparent-info"
                >
                  <i class="ti ti-square-rounded text-info me-2"></i>Congé
                  annuel
                </div>
              </div>
            </div>
            <!-- /Event -->

            <!-- Upcoming Event -->
            <div class="border-bottom pb-2 mb-4">
              <h5 class="mb-2">
                Upcoming Event<span
                  class="badge badge-success rounded-pill ms-2"
                  >15</span
                >
              </h5>
              <div class="border-start border-purple border-3 mb-3">
                <div class="ps-3">
                  <h6 class="fw-medium mb-1">Meeting with Team Dev</h6>
                  <p class="fs-12">
                    <i class="ti ti-calendar-check text-info me-2"></i>15 Mar
                    2025
                  </p>
                </div>
              </div>
              <div class="border-start border-pink border-3 mb-3">
                <div class="ps-3">
                  <h6 class="fw-medium mb-1">Design System With Client</h6>
                  <p class="fs-12">
                    <i class="ti ti-calendar-check text-info me-2"></i>24 Mar
                    2025
                  </p>
                </div>
              </div>
              <div class="border-start border-success border-3 mb-3">
                <div class="ps-3">
                  <h6 class="fw-medium mb-1">UI/UX Team Call</h6>
                  <p class="fs-12">
                    <i class="ti ti-calendar-check text-info me-2"></i>28 Mar
                    2025
                  </p>
                </div>
              </div>
            </div>
            <!-- /Upcoming Event -->

            <!-- Upgrade Details -->
            <!-- <div class="bg-dark rounded text-center position-relative p-4">
              <span class="avatar avatar-lg rounded-circle bg-white mb-2">
                <i class="ti ti-alert-triangle text-dark"></i>
              </span>
              <h6 class="text-white mb-3">

              </h6>
              <a href="#" class="btn btn-white"
                ><i class="ti ti-arrow-right"></i
              ></a>
              <div class="box-bg">
                <span class="bg-right"
                  ></span>
                <span class="bg-left"
                  ></span>
              </div>
            </div> -->
            <!-- /Upgrade Details -->
          </div>
        </div>
      </div>
      <!-- /Calendar Sidebar -->

      <div class="col-xxl-9 col-xl-8 theiaStickySidebar">
        <div class="card border-0">
          <div class="card-body">
            <div
              class="calendar-header bg-white border-bottom p-3 d-flex align-items-center justify-content-between"
            >
              <div class="d-flex align-items-center gap-3">
                <div class="d-flex align-items-center gap-2">
                  <button class="btn btn-light p-1" (click)="navigate('prev')">
                    <i class="ti ti-chevron-left"></i>
                  </button>
                  <span class="fw-semibold px-2">{{ getPeriodLabel() }}</span>
                  <button class="btn btn-light p-1" (click)="navigate('next')">
                    <i class="ti ti-chevron-right"></i>
                  </button>
                </div>
              </div>
              <div class="d-flex align-items-center gap-3">
                <div class="position-relative">
                  <input
                    type="text"
                    class="form-control ps-4"
                    placeholder="Rechercher"
                    style="width: 220px"
                  />
                  <i
                    class="ti ti-search position-absolute top-50 start-0 translate-middle-y ms-2 text-secondary"
                  ></i>
                </div>
                <div class="bg-light rounded d-flex">
                  <button
                    class="btn btn-sm rounded-0"
                    [class.btn-primary]="view === 'month'"
                    [class.text-white]="view === 'month'"
                    (click)="changeView('month')"
                  >
                    Mois
                  </button>
                  <button
                    class="btn btn-sm rounded-0"
                    [class.btn-primary]="view === 'week'"
                    [class.text-white]="view === 'week'"
                    (click)="changeView('week')"
                  >
                    Semaine
                  </button>
                </div>
              </div>
            </div>

            <!-- Calendar Grid -->
            <!-- Calendar Grid, valable pour month ET week -->
            <div class="calendar-table-container" [ngClass]="{'month-view': view === 'month', 'week-view': view === 'week'}">
              <table class="table table-bordered mb-0 align-middle">
                <thead class="table-light">
                  <tr>
                    <th style="min-width: 210px">Team member</th>
                    <th
                      *ngFor="let day of visibleDays"
                      class="text-center"
                      style="min-width: 42px"
                    >
                      <div class="fw-bold">{{ day.label }}</div>
                      <div
                        class="text-muted text-uppercase"
                        style="font-size: 11px"
                      >
                        {{ day.dayName }}
                      </div>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let employee of employees" >
                    <td style="min-width: 210px" >
                      <div class="d-flex align-items-center gap-2">
                        <div
                          class="avatar-sm rounded-circle d-flex align-items-center justify-content-center me-2"
                        >
                          <span class="fw-bold">{{
                            getInitials(employee.title)
                          }}</span>
                        </div>
                        <div>
                          <div
                            class="fw-medium text-dark"
                            style="font-size: 14px"
                          >
                          <a href="javascript:void(0);" (click)="employee.id && goToEmployeeHistory(employee.id)" class="me-2"
                          >{{employee.title}}</a>

                          </div>
                          <!-- Ajoute le poste si tu veux (à récupérer dans le retour API si besoin) -->
                        </div>
                      </div>
                    </td>
                    <td
                      *ngFor="let day of visibleDays"
                      [ngStyle]="
                        getEventForCell(employee.id, day.date)
                          ? {
                              background: getEventForCell(employee.id, day.date)
                                ?.color
                            }
                          : {}
                      "
                    ></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add New Event -->
<div class="modal fade" id="add_event">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Add New Event</h4>
        <button
          type="button"
          class="btn-close custom-btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        >
          <i class="ti ti-x"></i>
        </button>
      </div>
      <form>
        <div class="modal-body">
          <div class="row">
            <div class="col-12">
              <div class="mb-3">
                <label [htmlFor]="" class="form-label">Event Name</label>
                <input type="text" class="form-control" />
              </div>
            </div>
            <div class="col-12">
              <div class="mb-3 ngx-date">
                <label [htmlFor]="" class="form-label">Event Date</label>
                <div class="input-icon-end position-relative">
                  <input
                    type="text"
                    class="form-control datetimepicker"
                    bsDatepicker
                    container=".ngx-date"
                    [bsConfig]="{ adaptivePosition: true }"
                    placeholder="dd/mm/yyyy"
                    value="02-05-2024"
                  />
                  <span class="input-icon-addon">
                    <i class="ti ti-calendar text-gray-7"></i>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label [htmlFor]="" class="form-label">Start Time</label>
                <div class="input-icon-end position-relative">
                  <p-calendar
                    inputId="calendar-timeonly"
                    placeholder="Choose"
                    inputStyleClass="form-control timepicker w-100"
                    [(ngModel)]="addtime2"
                    [timeOnly]="true"
                    [ngModelOptions]="{ standalone: true }"
                    [hourFormat]="'12'"
                  />
                  <span class="input-icon-addon">
                    <i class="ti ti-clock text-gray-7"></i>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label [htmlFor]="" class="form-label">End Time</label>
                <div class="input-icon-end position-relative">
                  <p-calendar
                    inputId="calendar-timeonly"
                    placeholder="Choose"
                    inputStyleClass="form-control timepicker w-100"
                    [(ngModel)]="addtime"
                    [timeOnly]="true"
                    [ngModelOptions]="{ standalone: true }"
                    [hourFormat]="'12'"
                  />
                  <span class="input-icon-addon">
                    <i class="ti ti-clock text-gray-7"></i>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div class="mb-3">
                <label [htmlFor]="" class="form-label">Event Location</label>
                <input type="text" class="form-control" />
              </div>
              <div class="mb-0">
                <label [htmlFor]="" class="form-label">Descriptions</label>
                <textarea class="form-control" rows="3"></textarea>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-light me-2"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="button" data-bs-dismiss="modal" class="btn btn-primary">
            Add Event
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- /Add New Event -->

<!-- Event -->
<div
  class="modal fade"
  id="event_modal"
  [ngClass]="{ show: showEventDetailsModal }"
  [ngStyle]="{ display: showEventDetailsModal ? 'block' : 'none' }"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-dark modal-bg">
        <div class="modal-title text-white">
          <span id="eventTitle">{{ eventDetails.title }}</span>
        </div>
        <button
          type="button"
          class="btn-close custom-btn-close"
          data-bs-dismiss="modal"
          (click)="handleEventDetailsClose()"
          aria-label="Close"
        >
          <i class="ti ti-x"></i>
        </button>
      </div>
      <div class="modal-body">
        <p class="d-flex align-items-center fw-medium text-black mb-3">
          <i class="ti ti-calendar-check text-default me-2"></i>26 Jul,2024 to
          31 Jul,2024
        </p>
        <p class="d-flex align-items-center fw-medium text-black mb-3">
          <i class="ti ti-calendar-check text-default me-2"></i>11:00 AM to
          12:15 PM
        </p>
        <p class="d-flex align-items-center fw-medium text-black mb-3">
          <i class="ti ti-map-pin-bolt text-default me-2"></i>Las Vegas, US
        </p>
        <p class="d-flex align-items-center fw-medium text-black mb-0">
          <i class="ti ti-calendar-check text-default me-2"></i>A recurring or
          repeating event is simply any event that you will occur more than once
          on your calendar.
        </p>
      </div>
    </div>
  </div>
</div>
<!-- /Event -->
<ng-container *ngIf="showEventDetailsModal">
  <div
    (click)="handleEventDetailsClose()"
    (keypress)="handleEventDetailsClose()"
    tabindex="1"
    class="modal-backdrop fade show"
  ></div>
</ng-container>
